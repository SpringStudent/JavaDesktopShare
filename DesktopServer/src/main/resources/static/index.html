<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
<select id="clients" onchange="clientChange()">
    <option id="-1">---请选择---</option>
</select>
<input type="button" value="获取桌面" hidden="true"/></br>
<canvas id="screen"></canvas>
<script type="text/javascript" src="js/jsmpeg.min.js"></script>
<script type="text/javascript">
    var player;
    var ajaxObj = new XMLHttpRequest();
    ajaxObj.open('GET', 'http://172.16.1.200:11111/clients');
    ajaxObj.send();
    ajaxObj.onreadystatechange = function () {
        if (ajaxObj.readyState == 4 && ajaxObj.status == 200) {
            var data = JSON.parse(ajaxObj.responseText);
            var add = document.getElementById("clients");
            add.innerHTML = "<option id=\"-1\">---请选择---</option>";
            for (var i = 0; i < data.length; i++) {
                var option = document.createElement("option");
                option.id = data[i];
                option.innerText = data[i];
                add.append(option);
            }
        }
    }

    function clientChange() {
        var client = document.getElementById("clients");
        var id = client.options[client.selectedIndex].id;
        var canvas = document.getElementById('screen');
        var url = 'ws://172.16.1.200:11111/desktop?id=' + id;
        if (id != -1) {
            player = new JSMpeg.Player(url, {canvas: canvas});
        }
        if (player != undefined) {
            player.stop()
        }
    }
</script>
</body>
</html>
